@page "/setup"
@inject NavigationManager Navigation
@inject Services.SetupService SetupService
@rendermode @(new InteractiveServerRenderMode())

<div class="setup-overlay">
    <div class="setup-wizard">
        <div class="setup-header">
            <div class="setup-logo">
                <i class="fas fa-rocket"></i>
                <h1>CoreHub Setup</h1>
            </div>
            <div class="setup-header-info">
                <span class="setup-step-counter">Step @currentStep of @totalSteps</span>
                <div class="setup-progress-bar">
                    <div class="setup-progress-fill" style="width: @(((double)currentStep / totalSteps) * 100)%"></div>
                </div>
            </div>
        </div>

        <div class="setup-body">
            <div class="setup-content-wrapper">
                @if (currentStep == 1)
                {
                    <div class="setup-step fadeIn">
                        <div class="setup-step-icon">
                            <i class="fas fa-hand-wave"></i>
                        </div>
                        <h2 class="setup-step-title">Welcome to CoreHub!</h2>
                        <p class="setup-step-description">
                            We're excited to have you here. Let's customize your practice in just a few minutes.
                        </p>
                        <div class="setup-benefits">
                            <div class="benefit-item">
                                <i class="fas fa-circle-check"></i>
                                <span>Automated client management</span>
                            </div>
                            <div class="benefit-item">
                                <i class="fas fa-circle-check"></i>
                                <span>Smart scheduling & reminders</span>
                            </div>
                            <div class="benefit-item">
                                <i class="fas fa-circle-check"></i>
                                <span>Integrated billing & invoicing</span>
                            </div>
                        </div>
                    </div>
                }
                else if (currentStep == 2)
                {
                    <div class="setup-step fadeIn">
                        <div class="setup-step-icon">
                            <i class="fas fa-hospital"></i>
                        </div>
                        <h2 class="setup-step-title">What type of practice are you running?</h2>
                        <p class="setup-step-description">Choose the option that best describes your practice</p>
                        
                        <div class="practice-type-grid">
                            @foreach (var type in practiceTypes)
                            {
                                <div class="practice-type-option @(setupData.PracticeType == type ? "selected" : "")" 
                                     @onclick="() => setupData.PracticeType = type">
                                    <i class="fas @GetPracticeIcon(type)"></i>
                                    <span>@type</span>
                                    @if (setupData.PracticeType == type)
                                    {
                                        <i class="fas fa-check-circle selection-check"></i>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                }
                else if (currentStep == 3)
                {
                    <div class="setup-step fadeIn">
                        <div class="setup-step-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <h2 class="setup-step-title">Tell us about your practice</h2>
                        <p class="setup-step-description">We'll use this information across the platform</p>
                        
                        <div class="setup-form">
                            <div class="form-group">
                                <label>Practice Name <span class="required">*</span></label>
                                <input type="text" class="form-control" @bind="setupData.PracticeName" placeholder="e.g., Wellness Psychology Clinic" />
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Street Address</label>
                                    <input type="text" class="form-control" @bind="setupData.StreetAddress" placeholder="123 Main Street" />
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>City</label>
                                    <input type="text" class="form-control" @bind="setupData.City" placeholder="London" />
                                </div>
                                <div class="form-group">
                                    <label>Postcode</label>
                                    <input type="text" class="form-control" @bind="setupData.Postcode" placeholder="SW1A 1AA" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" class="form-control" @bind="setupData.PhoneNumber" placeholder="020 1234 5678" />
                            </div>
                        </div>
                    </div>
                }
                else if (currentStep == 4)
                {
                    <div class="setup-step fadeIn">
                        <div class="setup-step-icon">
                            <i class="fas fa-user-doctor"></i>
                        </div>
                        <h2 class="setup-step-title">How should clients see your name?</h2>
                        <p class="setup-step-description">This appears on appointment bookings and client communications</p>
                        
                        <div class="setup-form">
                            <div class="form-group">
                                <label>Display Name <span class="required">*</span></label>
                                <input type="text" class="form-control" @bind="setupData.PractitionerDisplayName" placeholder="Dr. Sarah Johnson" />
                                <small class="form-text">This is how clients will see your name in the portal</small>
                            </div>
                            <div class="form-group">
                                <label>Official/Legal Name</label>
                                <input type="text" class="form-control" @bind="setupData.PractitionerOfficialName" placeholder="Dr. Sarah Jane Johnson, Ph.D." />
                                <small class="form-text">Used for official documents and reports</small>
                            </div>
                        </div>
                    </div>
                }
                else if (currentStep == 5)
                {
                    <div class="setup-step fadeIn">
                        <div class="setup-step-icon">
                            <i class="fas fa-briefcase-medical"></i>
                        </div>
                        <h2 class="setup-step-title">What services do you offer?</h2>
                        <p class="setup-step-description">Add your main services with pricing</p>
                        
                        <div class="services-list">
                            @foreach (var service in setupData.Services)
                            {
                                <div class="service-item">
                                    <div class="service-row">
                                        <input type="text" class="form-control" @bind="service.Name" placeholder="Service name" />
                                        <input type="number" class="form-control service-duration" @bind="service.Duration" placeholder="Minutes" />
                                        <div class="input-group service-price">
                                            <span class="input-group-text">Â£</span>
                                            <input type="number" class="form-control" @bind="service.Price" placeholder="0.00" step="0.01" />
                                        </div>
                                        <button class="btn-remove" @onclick="() => RemoveService(service)">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            }
                        </div>
                        <button class="btn-add-service" @onclick="AddService">
                            <i class="fas fa-plus"></i> Add Another Service
                        </button>
                    </div>
                }
                else if (currentStep == 6)
                {
                    <div class="setup-step fadeIn">
                        <div class="setup-step-icon">
                            <i class="fas fa-calendar-days"></i>
                        </div>
                        <h2 class="setup-step-title">When are you available?</h2>
                        <p class="setup-step-description">Set your weekly schedule</p>
                        
                        <div class="availability-list">
                            @foreach (var day in setupData.Availability)
                            {
                                <div class="availability-row">
                                    <div class="day-toggle">
                                        <input type="checkbox" id="day-@day.Day" @bind="day.IsAvailable" />
                                        <label for="day-@day.Day">@day.Day</label>
                                    </div>
                                    @if (day.IsAvailable)
                                    {
                                        <div class="time-inputs">
                                            <select class="form-control time-select" @bind="day.StartTime">
                                                @foreach (var time in GenerateTimeOptions())
                                                {
                                                    <option value="@time">@time</option>
                                                }
                                            </select>
                                            <span class="time-separator">to</span>
                                            <select class="form-control time-select" @bind="day.EndTime">
                                                @foreach (var time in GenerateTimeOptions())
                                                {
                                                    <option value="@time">@time</option>
                                                }
                                            </select>
                                        </div>
                                    }
                                    else
                                    {
                                        <span class="unavailable-text">Unavailable</span>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                }
                else if (currentStep == 7)
                {
                    <div class="setup-step fadeIn">
                        <div class="setup-step-icon">
                            <i class="fas fa-sliders"></i>
                        </div>
                        <h2 class="setup-step-title">Booking preferences</h2>
                        <p class="setup-step-description">Customize how clients can book with you</p>
                        
                        <div class="preference-cards">
                            <div class="preference-card">
                                <div class="preference-header">
                                    <i class="fas fa-globe"></i>
                                    <h3>Online Bookings</h3>
                                </div>
                                <p>Allow clients to book appointments through your portal</p>
                                <div class="preference-toggle">
                                    <label class="switch">
                                        <input type="checkbox" @bind="setupData.AllowOnlineBookings" />
                                        <span class="slider"></span>
                                    </label>
                                    <span class="toggle-label">@(setupData.AllowOnlineBookings ? "Enabled" : "Disabled")</span>
                                </div>
                            </div>
                            
                            <div class="preference-card">
                                <div class="preference-header">
                                    <i class="fas fa-user-plus"></i>
                                    <h3>Accept New Clients</h3>
                                </div>
                                <p>Allow new clients to book their first appointment</p>
                                <div class="preference-toggle">
                                    <label class="switch">
                                        <input type="checkbox" @bind="setupData.AllowNewClients" />
                                        <span class="slider"></span>
                                    </label>
                                    <span class="toggle-label">@(setupData.AllowNewClients ? "Enabled" : "Disabled")</span>
                                </div>
                            </div>
                            
                            <div class="preference-card">
                                <div class="preference-header">
                                    <i class="fas fa-clock"></i>
                                    <h3>Advance Notice</h3>
                                </div>
                                <p>Minimum notice time for bookings</p>
                                <select class="form-control" @bind="setupData.MinimumNoticeTime">
                                    <option value="1">1 hour</option>
                                    <option value="2">2 hours</option>
                                    <option value="4">4 hours</option>
                                    <option value="12">12 hours</option>
                                    <option value="24">24 hours</option>
                                    <option value="48">48 hours</option>
                                    <option value="72">72 hours</option>
                                </select>
                            </div>
                        </div>
                    </div>
                }
                else if (currentStep == 8)
                {
                    <div class="setup-step fadeIn">
                        <div class="setup-step-icon success">
                            <i class="fas fa-party-horn"></i>
                        </div>
                        <h2 class="setup-step-title">You're all set!</h2>
                        <p class="setup-step-description">
                            Great job! Your CoreHub account is ready to go.
                        </p>
                        
                        <div class="completion-summary">
                            <div class="summary-item">
                                <i class="fas fa-building"></i>
                                <div>
                                    <strong>@setupData.PracticeName</strong>
                                    <span>@setupData.PracticeType</span>
                                </div>
                            </div>
                            <div class="summary-item">
                                <i class="fas fa-briefcase-medical"></i>
                                <div>
                                    <strong>@setupData.Services.Count Services</strong>
                                    <span>Ready for booking</span>
                                </div>
                            </div>
                            <div class="summary-item">
                                <i class="fas fa-calendar-check"></i>
                                <div>
                                    <strong>@setupData.Availability.Count(d => d.IsAvailable) Days Available</strong>
                                    <span>Weekly schedule configured</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="next-steps">
                            <h3>What's Next?</h3>
                            <ul>
                                <li><i class="fas fa-arrow-right"></i> Add your first client</li>
                                <li><i class="fas fa-arrow-right"></i> Set up automated reminders</li>
                                <li><i class="fas fa-arrow-right"></i> Explore your dashboard</li>
                            </ul>
                        </div>
                    </div>
                }
            </div>
        </div>

        <div class="setup-footer">
            <button class="btn-secondary" @onclick="PreviousStep" disabled="@(currentStep == 1)">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            
            <div class="setup-dots">
                @for (int i = 1; i <= totalSteps; i++)
                {
                    <span class="dot @(i == currentStep ? "active" : "") @(i < currentStep ? "completed" : "")"></span>
                }
            </div>
            
            @if (currentStep < totalSteps)
            {
                <button class="btn-primary" @onclick="NextStep" disabled="@(!CanProceed())">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            }
            else
            {
                <button class="btn-success" @onclick="CompleteSetup">
                    Get Started <i class="fas fa-rocket"></i>
                </button>
            }
        </div>
    </div>
</div>

<style>
    .setup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        overflow-y: auto;
        padding: 2rem 1rem;
    }

    .setup-wizard {
        background: white;
        border-radius: 24px;
        max-width: 800px;
        width: 100%;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        display: flex;
        flex-direction: column;
        max-height: 90vh;
    }

    .setup-header {
        padding: 2rem 2.5rem;
        border-bottom: 1px solid #e5e7eb;
    }

    .setup-logo {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .setup-logo i {
        font-size: 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .setup-logo h1 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 700;
        color: #1f2937;
    }

    .setup-header-info {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .setup-step-counter {
        font-size: 0.875rem;
        color: #6b7280;
        font-weight: 500;
    }

    .setup-progress-bar {
        height: 8px;
        background: #e5e7eb;
        border-radius: 999px;
        overflow: hidden;
    }

    .setup-progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-radius: 999px;
        transition: width 0.3s ease;
    }

    .setup-body {
        flex: 1;
        overflow-y: auto;
        padding: 2.5rem;
    }

    .setup-content-wrapper {
        min-height: 400px;
    }

    .setup-step {
        animation: fadeIn 0.4s ease;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .setup-step-icon {
        width: 80px;
        height: 80px;
        border-radius: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
    }

    .setup-step-icon i {
        font-size: 2.5rem;
        color: white;
    }

    .setup-step-icon.success {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .setup-step-title {
        font-size: 2rem;
        font-weight: 700;
        color: #1f2937;
        text-align: center;
        margin-bottom: 0.75rem;
    }

    .setup-step-description {
        font-size: 1.125rem;
        color: #6b7280;
        text-align: center;
        margin-bottom: 2.5rem;
        line-height: 1.6;
    }

    .setup-benefits {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        max-width: 500px;
        margin: 2rem auto 0;
    }

    .benefit-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 1.5rem;
        background: #f9fafb;
        border-radius: 12px;
    }

    .benefit-item i {
        font-size: 1.5rem;
        color: #10b981;
    }

    .benefit-item span {
        font-size: 1rem;
        color: #374151;
        font-weight: 500;
    }

    .practice-type-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 1rem;
    }

    .practice-type-option {
        padding: 1.5rem;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
    }

    .practice-type-option:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }

    .practice-type-option.selected {
        border-color: #667eea;
        background: #f5f7ff;
    }

    .practice-type-option i {
        font-size: 2rem;
        color: #667eea;
        display: block;
        margin-bottom: 0.75rem;
    }

    .practice-type-option span {
        display: block;
        font-weight: 500;
        color: #1f2937;
    }

    .selection-check {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        color: #10b981;
        font-size: 1.25rem;
    }

    .setup-form {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .form-group label {
        font-weight: 600;
        color: #374151;
        font-size: 0.875rem;
    }

    .required {
        color: #ef4444;
    }

    .form-control {
        padding: 0.75rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.2s;
    }

    .form-control:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-text {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .services-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .service-item {
        background: #f9fafb;
        border-radius: 12px;
        padding: 1rem;
    }

    .service-row {
        display: grid;
        grid-template-columns: 2fr 120px 140px 40px;
        gap: 0.75rem;
        align-items: center;
    }

    .service-duration {
        width: 100%;
    }

    .service-price {
        width: 100%;
    }

    .input-group {
        display: flex;
    }

    .input-group-text {
        padding: 0.75rem 1rem;
        background: #e5e7eb;
        border: 2px solid #e5e7eb;
        border-right: none;
        border-radius: 8px 0 0 8px;
        font-weight: 600;
    }

    .input-group .form-control {
        border-radius: 0 8px 8px 0;
    }

    .btn-remove {
        width: 40px;
        height: 40px;
        border: none;
        background: #fee2e2;
        color: #dc2626;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-remove:hover {
        background: #fecaca;
    }

    .btn-add-service {
        padding: 0.75rem 1.5rem;
        border: 2px dashed #d1d5db;
        background: transparent;
        color: #667eea;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        justify-content: center;
    }

    .btn-add-service:hover {
        border-color: #667eea;
        background: #f5f7ff;
    }

    .availability-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .availability-row {
        display: grid;
        grid-template-columns: 150px 1fr;
        gap: 1.5rem;
        align-items: center;
        padding: 1rem;
        background: #f9fafb;
        border-radius: 12px;
    }

    .day-toggle {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .day-toggle input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }

    .day-toggle label {
        font-weight: 600;
        color: #374151;
        cursor: pointer;
        margin: 0;
    }

    .time-inputs {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .time-select {
        flex: 1;
    }

    .time-separator {
        color: #6b7280;
        font-weight: 500;
    }

    .unavailable-text {
        color: #9ca3af;
        font-style: italic;
    }

    .preference-cards {
        display: grid;
        gap: 1.5rem;
    }

    .preference-card {
        padding: 1.5rem;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        transition: all 0.2s;
    }

    .preference-card:hover {
        border-color: #d1d5db;
    }

    .preference-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 0.75rem;
    }

    .preference-header i {
        font-size: 1.5rem;
        color: #667eea;
    }

    .preference-header h3 {
        margin: 0;
        font-size: 1.125rem;
        font-weight: 600;
        color: #1f2937;
    }

    .preference-card > p {
        color: #6b7280;
        margin-bottom: 1.25rem;
    }

    .preference-toggle {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #cbd5e1;
        transition: 0.3s;
        border-radius: 34px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.3s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    input:checked + .slider:before {
        transform: translateX(26px);
    }

    .toggle-label {
        font-weight: 600;
        color: #374151;
    }

    .completion-summary {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin: 2rem 0;
    }

    .summary-item {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        padding: 1.25rem;
        background: #f9fafb;
        border-radius: 12px;
    }

    .summary-item i {
        font-size: 1.75rem;
        color: #667eea;
    }

    .summary-item div {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .summary-item strong {
        color: #1f2937;
        font-size: 1.125rem;
    }

    .summary-item span {
        color: #6b7280;
        font-size: 0.875rem;
    }

    .next-steps {
        margin-top: 2rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, #f0f4ff 0%, #f5f3ff 100%);
        border-radius: 12px;
    }

    .next-steps h3 {
        margin: 0 0 1rem 0;
        color: #1f2937;
        font-size: 1.125rem;
    }

    .next-steps ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .next-steps li {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        color: #374151;
        font-weight: 500;
    }

    .next-steps li i {
        color: #667eea;
    }

    .setup-footer {
        padding: 1.5rem 2.5rem;
        border-top: 1px solid #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .setup-dots {
        display: flex;
        gap: 0.5rem;
    }

    .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #d1d5db;
        transition: all 0.3s;
    }

    .dot.active {
        width: 24px;
        border-radius: 4px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }

    .dot.completed {
        background: #10b981;
    }

    .btn-secondary,
    .btn-primary,
    .btn-success {
        padding: 0.75rem 2rem;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-secondary {
        background: #f3f4f6;
        color: #374151;
    }

    .btn-secondary:hover:not(:disabled) {
        background: #e5e7eb;
    }

    .btn-secondary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .btn-primary:hover:not(:disabled) {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-success {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
    }

    .btn-success:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    @@media (max-width: 768px) {
        .setup-overlay {
            padding: 0;
        }

        .setup-wizard {
            border-radius: 0;
            max-height: 100vh;
        }

        .setup-header,
        .setup-body,
        .setup-footer {
            padding: 1.5rem;
        }

        .practice-type-grid {
            grid-template-columns: 1fr 1fr;
        }

        .form-row {
            grid-template-columns: 1fr;
        }

        .service-row {
            grid-template-columns: 1fr;
        }

        .availability-row {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .setup-step-title {
            font-size: 1.5rem;
        }
    }
</style>

@code {
    private int currentStep = 1;
    private int totalSteps = 8;
    private SetupData setupData = new();

    private string[] practiceTypes = new[]
    {
        "Psychology", "Psychotherapy", "Counselling", "Psychiatry",
        "Physiotherapy", "Occupational Therapy", "Speech Therapy",
        "Dietetics", "Podiatry", "Chiropractic", "Osteopathy",
        "Acupuncture", "Massage Therapy", "Other"
    };

    protected override void OnInitialized()
    {
        setupData.Availability = new List<DayAvailability>
        {
            new() { Day = "Monday", IsAvailable = true },
            new() { Day = "Tuesday", IsAvailable = true },
            new() { Day = "Wednesday", IsAvailable = true },
            new() { Day = "Thursday", IsAvailable = true },
            new() { Day = "Friday", IsAvailable = true },
            new() { Day = "Saturday", IsAvailable = false },
            new() { Day = "Sunday", IsAvailable = false }
        };

        setupData.Services = new List<ServiceData>
        {
            new() { Name = "", Duration = 60, Price = 0 }
        };
    }

    private void NextStep()
    {
        if (currentStep < totalSteps)
        {
            currentStep++;
        }
    }

    private void PreviousStep()
    {
        if (currentStep > 1)
        {
            currentStep--;
        }
    }

    private bool CanProceed()
    {
        return currentStep switch
        {
            2 => !string.IsNullOrWhiteSpace(setupData.PracticeType),
            3 => !string.IsNullOrWhiteSpace(setupData.PracticeName),
            4 => !string.IsNullOrWhiteSpace(setupData.PractitionerDisplayName),
            _ => true
        };
    }

    private void AddService()
    {
        setupData.Services.Add(new ServiceData { Name = "", Duration = 60, Price = 0 });
    }

    private void RemoveService(ServiceData service)
    {
        if (setupData.Services.Count > 1)
        {
            setupData.Services.Remove(service);
        }
    }

    private List<string> GenerateTimeOptions()
    {
        var times = new List<string>();
        for (int hour = 6; hour <= 21; hour++)
        {
            times.Add($"{hour:D2}:00");
            if (hour < 21)
            {
                times.Add($"{hour:D2}:30");
            }
        }
        return times;
    }

    private string GetPracticeIcon(string type)
    {
        return type switch
        {
            "Psychology" => "fa-brain",
            "Psychotherapy" => "fa-comments",
            "Counselling" => "fa-user-tie",
            "Psychiatry" => "fa-head-side-medical",
            "Physiotherapy" => "fa-person-walking",
            "Occupational Therapy" => "fa-hands-helping",
            "Speech Therapy" => "fa-microphone",
            "Dietetics" => "fa-apple-whole",
            "Podiatry" => "fa-shoe-prints",
            "Chiropractic" => "fa-spine",
            "Osteopathy" => "fa-bone",
            "Acupuncture" => "fa-syringe",
            "Massage Therapy" => "fa-hands",
            _ => "fa-stethoscope"
        };
    }

    private void CompleteSetup()
    {
        // TODO: Save setup data to database
        SetupService.CompleteSetup();
        Navigation.NavigateTo("/dashboard", forceLoad: true);
    }

    public class SetupData
    {
        public string PracticeType { get; set; } = "";
        public string PracticeName { get; set; } = "";
        public string StreetAddress { get; set; } = "";
        public string City { get; set; } = "";
        public string Postcode { get; set; } = "";
        public string PhoneNumber { get; set; } = "";
        public string PractitionerDisplayName { get; set; } = "";
        public string PractitionerOfficialName { get; set; } = "";
        public List<DayAvailability> Availability { get; set; } = new();
        public List<ServiceData> Services { get; set; } = new();
        public bool AllowOnlineBookings { get; set; } = true;
        public bool AllowNewClients { get; set; } = true;
        public string MinimumNoticeTime { get; set; } = "12";
    }

    public class DayAvailability
    {
        public string Day { get; set; } = "";
        public bool IsAvailable { get; set; }
        public string StartTime { get; set; } = "09:00";
        public string EndTime { get; set; } = "17:00";
    }

    public class ServiceData
    {
        public string Name { get; set; } = "";
        public int Duration { get; set; }
        public decimal Price { get; set; }
    }
}
